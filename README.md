# mycelium

<!-- Decentralized P2P social network in which every interaction is recorded as a locally replicated, signed acknowledgement. Those pairwise histories weave together into a shared, tamper-resistant record, and users earn tokens by contributing to that record. -->

## Repository Layout

```plain
mycelium/
├─ core/
│   ├─ Cargo.toml         # package.name = "mycelium_core"
│   └─ src/
│       ├─ lib.rs         # public API exports
│       ├─ api/           # Rust-side FFI layer
│       │   ├─ connection.rs    # connection-related FFI functions
│       │   ├─ discovery.rs     # peer discovery FFI functions
│       │   ├─ error.rs         # FFI error types and conversions
│       │   ├─ messaging.rs     # messaging FFI functions (Pub/Sub, request/response)
│       │   ├─ storage.rs       # storage FFI functions
│       │   └─ types.rs         # shared FFI type definitions and converters
│       ├─ domain/        # SNS business logic
│       ├─ network/       # P2P networking modules
│       ├─ storage/       # persistence layer
│       └─ util/          # shared utilities and helpers
└─ ui/
    ├─ pubspec.yaml       # Flutter package (name: mycelium_ui)
    └─ lib/
        ├─ src/
        │   └─ main.dart  # Flutter entrypoint
        └─ api/           # bindings generated by flutter_rust_bridge_codegen
```

## Build & Run

### 1. Prerequisites

* Rust toolchain (>= 1.82)
* Dart SDK (>= 2.19)
* Flutter SDK (>= 3.0)

### 2. Install the Codegen Tool

```bash
cargo install flutter_rust_bridge_codegen
```

Refer to the [official quickstart](https://cjycode.com/flutter_rust_bridge/quickstart#1-install) for details.

### 3. Generate FFI Bindings

Run the following command to generate Flutter bindings from the public Rust API:

```bash
cd ui
flutter_rust_bridge_codegen generate
```

### 4. Run the Flutter App

```bash
cd ui
flutter pub get
flutter run
```

## Development Tips

### Regenerate FFI bindings after any Rust API change

```bash
cd ui
flutter_rust_bridge_codegen generate --watch
```

### Export new Rust APIs

When adding new types or functionality, place them in `core/src/api/`.

### CI integration

Include the following steps in your CI pipeline:

```bash
flutter_rust_bridge_codegen generate
cargo test
flutter test
```
